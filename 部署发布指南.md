# 部署和发布指南

## 快速发布流程

### 1. 准备发布

确保所有改动已提交：
```bash
git add .
git commit -m "Release v1.0.0"
git push origin main
```

### 2. 创建并推送Tag

```bash
# 创建Tag
git tag -a v1.0.0 -m "Release version 1.0.0"

# 推送Tag
git push origin v1.0.0
```

### 3. 自动构建

推送Tag后，GitHub Actions会自动：
1. 在Windows环境下构建可执行文件
2. 创建GitHub Release
3. 上传可执行文件和文档

### 4. 完善Release说明

访问GitHub Releases页面，编辑自动创建的Release，添加：
- 本版本的新功能
- 修复的Bug
- 使用说明
- 已知问题

## 本地测试构建

在推送Tag前，建议先本地测试：

### Windows
```batch
build.bat
```

### macOS/Linux
```bash
./build.sh
```

测试生成的可执行文件是否正常工作。

## 版本号规则

使用语义化版本：`v主版本.次版本.修订版`

- **主版本（Major）**：重大不兼容更新
  - 示例：v1.0.0 → v2.0.0
  
- **次版本（Minor）**：向下兼容的新功能
  - 示例：v1.0.0 → v1.1.0
  
- **修订版（Patch）**：向下兼容的Bug修复
  - 示例：v1.0.0 → v1.0.1

## 发布检查清单

在发布前，确保：

- [ ] 所有功能正常工作
- [ ] 测试脚本通过（`python test.py`）
- [ ] 本地构建成功
- [ ] 更新了CHANGELOG.md
- [ ] 更新了README.md（如有必要）
- [ ] 更新了相关文档
- [ ] 代码已提交并推送
- [ ] 版本号符合语义化规范

## 发布后

1. **通知用户**
   - 发送更新通知
   - 说明新功能和改进
   
2. **监控反馈**
   - 关注GitHub Issues
   - 及时回复用户问题
   
3. **准备下一版本**
   - 创建新的开发分支
   - 规划下一版本功能

## GitHub仓库设置

### 首次设置

1. **创建GitHub仓库**
```bash
# 在GitHub上创建新仓库后
git remote add origin https://github.com/your-username/wendangchuli2.git
git branch -M main
git push -u origin main
```

2. **启用GitHub Actions**
   - 仓库设置 → Actions → 允许所有操作

3. **配置Secrets（如需要）**
   - 仓库设置 → Secrets and variables → Actions
   - 添加必要的密钥（如代码签名证书）

### 保护分支（可选）

为main分支启用保护：
1. 仓库设置 → Branches
2. 添加规则保护main分支
3. 要求Pull Request审查
4. 要求状态检查通过

## 常见问题

### Q: GitHub Actions构建失败？
A: 查看Actions日志，常见原因：
- 依赖安装失败
- PyInstaller配置错误
- 缺少必要文件

### Q: 如何删除错误的Tag？
A: 
```bash
# 删除本地Tag
git tag -d v1.0.0

# 删除远程Tag
git push origin :refs/tags/v1.0.0
```

### Q: 如何修改已发布的Release？
A: 在GitHub Releases页面：
1. 找到对应Release
2. 点击"Edit release"
3. 修改说明或添加/删除文件
4. 保存更改

### Q: 如何发布预发布版本？
A: 
1. 使用带后缀的Tag：`v1.0.0-beta.1`
2. 在Release页面勾选"This is a pre-release"

## 版本示例

### 首个正式版本
```bash
git tag -a v1.0.0 -m "First stable release"
git push origin v1.0.0
```

### 功能更新
```bash
git tag -a v1.1.0 -m "Add new features"
git push origin v1.1.0
```

### Bug修复
```bash
git tag -a v1.0.1 -m "Fix critical bugs"
git push origin v1.0.1
```

### 预发布版本
```bash
git tag -a v2.0.0-beta.1 -m "Beta release for testing"
git push origin v2.0.0-beta.1
```

## 自动化脚本

创建`release.sh`简化发布流程：

```bash
#!/bin/bash
# release.sh - 自动发布脚本

VERSION=$1

if [ -z "$VERSION" ]; then
    echo "Usage: ./release.sh v1.0.0"
    exit 1
fi

echo "Preparing release $VERSION..."

# 运行测试
python test.py
if [ $? -ne 0 ]; then
    echo "Tests failed!"
    exit 1
fi

# 提交所有改动
git add .
git commit -m "Release $VERSION"

# 创建Tag
git tag -a $VERSION -m "Release $VERSION"

# 推送
git push origin main
git push origin $VERSION

echo "Release $VERSION created successfully!"
echo "Check GitHub Actions for build status."
```

使用方法：
```bash
chmod +x release.sh
./release.sh v1.0.0
```

## 持续集成最佳实践

1. **每次提交都运行测试**
2. **保持构建快速**（< 10分钟）
3. **失败时立即修复**
4. **定期更新依赖**
5. **保持文档同步**

## 相关文档

- [GitHub Actions指南](./GitHub_Actions指南.md)
- [CHANGELOG](./CHANGELOG.md)
- [README](./README.md)

---

**提示**：首次发布前，建议先用测试仓库练习整个流程。
