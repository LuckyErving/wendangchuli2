# 操作指南

## 快速开始

### 方法1：使用启动脚本（推荐）
```bash
./start.sh
```

### 方法2：手动启动
```bash
source .venv/bin/activate
python main.py
```

## 详细操作步骤

### 第一步：准备工作

1. **整理目录结构**
   - 确保你的图片文件已按照正确的目录结构组织
   - 村结构：根目录/家庭名
   - 乡结构：根目录/村名/家庭名

2. **上传到OSS（可选）**
   - 如果还没有上传，可以先用本工具生成二维码和PDF
   - 之后再上传文件到OSS
   - 确保OSS的目录结构与本地一致

### 第二步：启动应用

运行 `./start.sh` 或手动启动应用

### 第三步：配置参数

#### 1. 目录设置

**根目录**：
- 点击"浏览..."按钮
- 选择包含所有子目录的根目录
- 例如：选择"西沟乡麻地沟村（资料扫描）"文件夹

**目录结构**：
- **村（二级目录）**：根目录下直接是各家庭的文件夹
- **乡（三级目录）**：根目录/村/家庭的三层结构

#### 2. OSS设置

**OSS基础URL**：
- 格式：`https://你的bucket名.oss-区域.aliyuncs.com/路径前缀/`
- 示例：`https://my-documents.oss-cn-beijing.aliyuncs.com/xigou/`
- 程序会自动在这个URL后面添加目录名

例如：
- 如果目录名是"何皂皂"
- OSS基础URL是`https://my-bucket.oss-cn-beijing.aliyuncs.com/xigou/`
- 生成的二维码URL将是：`https://my-bucket.oss-cn-beijing.aliyuncs.com/xigou/何皂皂`

#### 3. PDF设置

**页面尺寸**：
- **A3**: 297mm × 420mm（最大）
- **A4**: 210mm × 297mm（常用）
- **A5**: 148mm × 210mm（小型）
- **自定义**: 可以输入任意尺寸

**自定义尺寸示例**：
- 信纸: 215.9mm × 279.4mm
- B4: 250mm × 353mm
- B5: 176mm × 250mm

#### 4. 二维码设置

**二维码大小**：
- 建议：30-80mm
- 太小可能扫描困难
- 太大会占用过多空间
- 默认：50mm

**位置设置（重要！）**：

坐标系统说明：
```
┌─────────────────────────┐ ← 顶部
│                         │
│                         │
│        [二维码]          │   Y轴向上
│                         │   ↑
│                         │   │
│                         │   │
└─────────────────────────┘   (0,0) → X轴向右
  ← 左边      底部 →
```

常用位置示例（A4页面，二维码50mm）：

1. **左下角**
   - X: 10mm
   - Y: 10mm

2. **右下角**
   - X: 150mm (210-50-10)
   - Y: 10mm

3. **左上角**
   - X: 10mm
   - Y: 237mm (297-50-10)

4. **右上角**
   - X: 150mm
   - Y: 237mm

5. **中心位置**
   - X: 80mm ((210-50)/2)
   - Y: 123.5mm ((297-50)/2)

### 第四步：执行生成

1. 确认所有参数设置正确
2. 点击"开始生成"按钮
3. 观察日志窗口的处理进度
4. 等待处理完成的提示

### 第五步：检查结果

处理完成后，在每个目标目录下会生成：
- `目录名_qr.png` - 二维码图片
- `目录名_qr.pdf` - 包含二维码的PDF文件

例如：
```
西沟乡麻地沟村（资料扫描）/
├── 何皂皂/
│   ├── image1.jpg
│   ├── image2.jpg
│   ├── 何皂皂_qr.png      ← 新生成
│   └── 何皂皂_qr.pdf      ← 新生成
```

## 常见场景配置

### 场景1：打印带二维码的A4纸，二维码在右下角

```
页面尺寸：A4
二维码大小：50mm
X坐标：150mm
Y坐标：10mm
```

### 场景2：制作名片大小的卡片（二维码居中）

```
页面尺寸：自定义
宽度：90mm
高度：55mm
二维码大小：30mm
X坐标：30mm
Y坐标：12.5mm
```

### 场景3：A5传单，二维码在左上角

```
页面尺寸：A5
二维码大小：40mm
X坐标：10mm
Y坐标：160mm (210-40-10)
```

## 故障排除

### 问题1：程序启动失败
- 确认虚拟环境已激活
- 运行 `pip install -r requirements.txt` 重新安装依赖

### 问题2：找不到图片
- 检查目录中是否包含支持的图片格式
- 支持格式：jpg, jpeg, png, gif, bmp, tiff, webp
- 检查文件扩展名的大小写

### 问题3：二维码位置不对
- 记住坐标原点在左下角
- Y坐标越大，二维码越靠近顶部
- X坐标越大，二维码越靠近右边
- 确保二维码不会超出页面边界

### 问题4：二维码扫描失败
- 增大二维码尺寸
- 确保打印质量清晰
- 检查OSS URL是否正确

### 问题5：某些目录被跳过
- 查看日志，可能是该目录没有图片
- 确保目录结构类型选择正确（村/乡）

## 批量处理建议

1. **先测试一个目录**
   - 使用一个小目录先测试
   - 确认二维码和PDF效果满意后再批量处理

2. **调整参数**
   - 根据测试结果调整二维码大小和位置
   - 预览生成的PDF确认效果

3. **批量处理**
   - 确认参数无误后，处理整个根目录
   - 处理过程中不要关闭程序

4. **验证结果**
   - 随机抽查几个目录的生成文件
   - 用手机扫描二维码测试

## 注意事项

1. **文件命名**：确保目录名不包含特殊字符，避免生成文件名问题
2. **权限**：确保程序对目录有读写权限
3. **磁盘空间**：确保有足够空间存储生成的文件
4. **OSS同步**：生成二维码后，记得将文件上传到OSS，确保链接有效
5. **备份**：处理前建议备份原始数据

## 上传到OSS的步骤

生成二维码和PDF后，需要将图片上传到OSS：

### 使用阿里云OSS控制台
1. 登录阿里云控制台
2. 进入OSS产品页
3. 选择对应的Bucket
4. 按照本地目录结构创建文件夹
5. 上传图片文件

### 使用ossutil工具（推荐批量上传）
```bash
# 安装ossutil
# 参考：https://help.aliyun.com/document_detail/120075.html

# 配置ossutil
ossutil config

# 批量上传
ossutil cp -r 本地目录路径 oss://bucket-name/远程路径 --update
```

## 技术支持

如遇到问题：
1. 查看日志窗口的错误信息
2. 运行测试脚本：`python test.py`
3. 查看README.md了解更多信息
